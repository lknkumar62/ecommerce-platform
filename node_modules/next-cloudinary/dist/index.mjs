import Ue,{useState as Ee,useCallback as Pe,forwardRef as we}from"react";import Ae from"next/image";import{pollForProcessingImage as de}from"@cloudinary-util/util";import{transformationPlugins as _e}from"@cloudinary-util/url-loader";import{constructCloudinaryUrl as Oe}from"@cloudinary-util/url-loader";import he from"next/package.json";var ee={name:"next-cloudinary",version:"6.17.5",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"4.0.0"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc || ^15",react:"^17 || ^18 || >=19.0.0-beta || ^19"}};var te="A",oe="V",re=ie(he.version),ne=ie(ee.version);function ie(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function w(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let d=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,a=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:d,cloudName:t},url:{...e?.url,secureDistribution:a,privateCdn:o}},e)}function H(e){return Object.assign({product:te,sdkCode:oe,sdkSemver:ne,techVersion:re,feature:""},e)}function T(e,t,d){return Oe({options:e,config:w(t),analytics:H(d)})}function q({loaderOptions:e,imageProps:t,cldOptions:d,cldConfig:a={}}){let o={...t,...d};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let n=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*n))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return T(o,a)}var xe=we(function(t,d){let a=!1,o=["assetType","config","deliveryType","strictTransformations"];_e.forEach(({props:r})=>{Object.keys(r).forEach(f=>{if(o.includes(f))throw new Error(`Option ${f} already exists!`);o.push(f)})});let n={alt:t.alt,src:t.src};Object.keys(t).filter(r=>typeof r=="string"&&!o.includes(r)).forEach(r=>n[r]=t[r]);let s=Object.keys(n).map(r=>`${r}:${n[r]}`).join(";"),[C,m]=Ee(s),p={};o.forEach(r=>{let g=t[r];g&&(p[r]=g)});let I=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||I?.unoptimized===!0)&&(n.src=T({...p,width:n.width,height:n.height,src:n.src,format:"default",quality:"default"},t.config));async function l(r){let g=!0;if(a)return;if(a=!0,typeof t.onError=="function"){let P=t.onError(r);typeof P=="boolean"&&P===!1&&(g=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(g=!1);if(g===!1)return;let f=r.target,O=await de({src:f.src});typeof O.error=="string"&&process.env.NODE_ENV==="development"&&console.error(`[CldImage] Failed to load image ${t.src}: ${O.error}`),O.success&&m(`${s};${Date.now()}`)}let A=Pe(l,[de,s]),h=Ae;return"default"in h&&(h=h.default),Ue.createElement(h,{key:C,...n,loader:r=>q({loaderOptions:r,imageProps:n,cldOptions:p,cldConfig:t.config}),onError:A,ref:d})}),ae=xe;import E from"react";import Le from"next/head";function X(e){return T({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var be="summary_large_image",ve=({excludeTags:e=[],twitterTitle:t,keys:d={},...a})=>{let{alt:o}=a,{width:n=1200,height:s=627}=a;n=typeof n=="string"?parseInt(n):n,s=typeof s=="string"?parseInt(s):s;let C=X({...a,width:n,height:s}),m=X({...a,width:n,height:s,format:a.format||"webp"}),p={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...d};return E.createElement(Le,null,E.createElement("meta",{key:p["og:image"],property:"og:image",content:C}),E.createElement("meta",{key:p["og:image:secure_url"],property:"og:image:secure_url",content:C}),E.createElement("meta",{key:p["og:image:width"],property:"og:image:width",content:`${n}`}),E.createElement("meta",{key:p["og:image:height"],property:"og:image:height",content:`${s}`}),o&&E.createElement("meta",{key:p["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&E.createElement("meta",{key:p["twitter:title"],property:"twitter:title",content:t||" "}),E.createElement("meta",{key:p["twitter:card"],property:"twitter:card",content:be}),E.createElement("meta",{key:p["twitter:image"],property:"twitter:image",content:m}))},le=ve;import F from"react";import $,{useState as J,useEffect as pe,useRef as ce}from"react";import Te from"next/script";import{generateSignatureCallback as Ne,generateUploadWidgetResultCallback as We,getUploadWidgetOptions as Me,UPLOAD_WIDGET_EVENTS as De}from"@cloudinary-util/url-loader";function se(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Se=()=>{let e=$.useId?.()??null,t=$.useRef(Math.floor(Math.random()*100)).current;return`cloudinary-uploadwidget-${e?e.replace(/:/g,""):t}`},Ve=({children:e,config:t,onError:d,onOpen:a,onUpload:o,options:n,signatureEndpoint:s,uploadPreset:C,...m})=>{let p=Se(),I=ce(),l=ce(),[A,h]=J(void 0),[r,g]=J(void 0),[f,O]=J(!0),P=w(t),W=s&&Ne({signatureEndpoint:String(s),fetch}),V=Me({uploadPreset:C||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:W,...n},P),M=We({onError:i=>{h(i),typeof d=="function"&&d(i,{widget:l.current,...u})},onResult:i=>{if(typeof i?.event!="string")return;g(i);let U=De[i.event];if(typeof U=="string"&&typeof m[U]=="function"){let S=m[U];S(i,{widget:l.current,...u})}let Y=`${U}Action`;if(Y&&typeof m[Y]=="function"){let S=m[Y];S(i)}}});pe(()=>{if(typeof r>"u")return;r.event==="success"&&typeof o=="function"&&(process.env.NODE_ENV==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(r,l.current))},[r]);function k(){O(!1),I.current||(I.current=window.cloudinary),se(()=>{l.current||(l.current=v())})}pe(()=>()=>{l.current?.destroy(),l.current=void 0},[]);function c(i,U=[]){if(l.current||(l.current=v()),typeof l?.current[i]=="function")return l.current[i](...U)}function G(i){c("close",[i])}function y(i){return c("destroy",[i])}function _(){c("hide")}function x(){return c("isDestroyed")}function L(){return c("isMinimized")}function R(){return c("isShowing")}function D(){c("minimize")}function b(i,U){c("open",[i,U]),typeof a=="function"&&a(l.current)}function j(){c("show")}function B(){c("update")}let u={close:G,destroy:y,hide:_,isDestroyed:x,isMinimized:L,isShowing:R,minimize:D,open:b,show:j,update:B};function v(){return I.current?.createUploadWidget(V,M)}return $.createElement($.Fragment,null,typeof e=="function"&&e({cloudinary:I.current,widget:l.current,results:r,error:A,isLoading:f,...u}),$.createElement(Te,{id:p,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:k,onError:i=>console.error(`Failed to load Cloudinary Upload Widget: ${i.message}`)}))},z=Ve;var ke=({className:e,children:t,onClick:d,onError:a,onOpen:o,onUpload:n,onAbort:s,onBatchCancelled:C,onClose:m,onDisplayChanged:p,onPublicId:I,onQueuesEnd:l,onQueuesStart:A,onRetry:h,onShowCompleted:r,onSourceChanged:g,onSuccess:f,onTags:O,onUploadAdded:P,options:W,signatureEndpoint:V,uploadPreset:M,onAbortAction:k,onBatchCancelledAction:c,onCloseAction:G,onDisplayChangedAction:y,onPublicIdAction:_,onQueuesEndAction:x,onQueuesStartAction:L,onRetryAction:R,onShowCompletedAction:D,onSourceChangedAction:b,onSuccessAction:j,onTagsAction:B,onUploadAddedAction:u,...v})=>F.createElement(F.Fragment,null,F.createElement(z,{onError:a,onOpen:o,onUpload:n,onAbort:s,onBatchCancelled:C,onClose:m,onDisplayChanged:p,onPublicId:I,onQueuesEnd:l,onQueuesStart:A,onRetry:h,onShowCompleted:r,onSourceChanged:g,onSuccess:f,onTags:O,onUploadAdded:P,options:W,signatureEndpoint:V,uploadPreset:M,onAbortAction:k,onBatchCancelledAction:c,onCloseAction:G,onDisplayChangedAction:y,onPublicIdAction:_,onQueuesEndAction:x,onQueuesStartAction:L,onRetryAction:R,onShowCompletedAction:D,onSourceChangedAction:b,onSuccessAction:j,onTagsAction:B,onUploadAddedAction:u},({open:i,isLoading:U})=>{function Y(S){S.preventDefault(),i(),typeof d=="function"&&d(S)}return F.createElement("button",{...v,className:e||"",onClick:Y,disabled:U},t||"Upload")})),ue=ke;import N,{useRef as Z,useEffect as ge,useId as Ge,useState as fe}from"react";import Re from"next/script";import je from"next/head";import{getVideoPlayerOptions as Be}from"@cloudinary-util/url-loader";var me=[],ye="1.11.1",Ye=e=>{let{className:t,config:d,disableRemotePlayback:a,height:o,id:n,onDataLoad:s,onError:C,onMetadataLoad:m,onPause:p,onPlay:I,onEnded:l,width:A}=e,h=Ge(),[r,g]=fe(!1),[f,O]=fe(!1),P=w(d),W=Be(e,P),{publicId:V}=W;if(typeof V>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let M=Z(),k=Z(),c=e.videoRef||k,G=Z(),y=e.playerRef||G,_=n||`player-${h.replace(/:/g,"")}`,x="cld-video-player cld-fluid";t&&(x=`${x} ${t}`);let L={error:C,loadeddata:s,loadedmetadata:m,pause:p,play:I,ended:l};function R(u){let v=L[u.type];typeof v=="function"&&v(B())}let D=()=>{y.current?.videojs?.cloudinary&&y.current.videojs.cloudinary.dispose(),me=me.filter(u=>u!==_),y.current=null,O(!1)},b=()=>{typeof window<"u"&&"cloudinary"in window&&c.current&&!f&&(M.current=window.cloudinary,y.current&&D(),y.current=M.current.videoPlayer(c.current,W),O(!0),Object.keys(L).forEach(u=>{typeof L[u]=="function"&&y.current?.on(u,R)}))};function j(){g(!0),"cloudinary"in window&&b()}ge(()=>(r&&typeof window<"u"&&"cloudinary"in window&&b(),()=>{D()}),[]),ge(()=>{r&&!f&&typeof window<"u"&&"cloudinary"in window&&b()},[r,f]);function B(){return{player:y.current,video:c.current}}return N.createElement(N.Fragment,null,N.createElement(je,null,N.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.css`,rel:"stylesheet"})),N.createElement("div",{style:{width:"100%"}},N.createElement("video",{ref:c,id:_,className:x,width:A,height:o,disableRemotePlayback:a}),N.createElement(Re,{id:`cloudinary-videoplayer-${_}`,src:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.js`,onLoad:j,onError:u=>console.error(`Failed to load Cloudinary Video Player: ${u.message}`)})))},Ce=Ye;import{constructCloudinaryUrl as $e}from"@cloudinary-util/url-loader";function He(e,t,d){return $e({options:{assetType:"video",format:"auto:video",...e},config:w(t),analytics:H(d)})}export{ae as CldImage,le as CldOgImage,ue as CldUploadButton,z as CldUploadWidget,Ce as CldVideoPlayer,q as cloudinaryLoader,T as getCldImageUrl,X as getCldOgImageUrl,He as getCldVideoUrl};
//# sourceMappingURL=index.mjs.map