"use strict";var Le=Object.create;var Q=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var Te=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty;var We=(e,t)=>{for(var n in t)Q(e,n,{get:t[n],enumerable:!0})},ae=(e,t,n,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ve(t))!Ne.call(e,o)&&o!==n&&Q(e,o,{get:()=>t[o],enumerable:!(d=be(t,o))||d.enumerable});return e};var h=(e,t,n)=>(n=e!=null?Le(Te(e)):{},ae(t||!e||!e.__esModule?Q(n,"default",{value:e,enumerable:!0}):n,e)),Me=e=>ae(Q({},"__esModule",{value:!0}),e);var Ye={};We(Ye,{CldImage:()=>te,CldOgImage:()=>ne,CldUploadButton:()=>ie,CldUploadWidget:()=>q,CldVideoPlayer:()=>de,cloudinaryLoader:()=>Z,getCldImageUrl:()=>L,getCldOgImageUrl:()=>F,getCldVideoUrl:()=>xe});module.exports=Me(Ye);var b=h(require("react")),ye=h(require("next/image")),ee=require("@cloudinary-util/util"),Ce=require("@cloudinary-util/url-loader");var me=require("@cloudinary-util/url-loader");var se=h(require("next/package.json"));var le={name:"next-cloudinary",version:"6.17.5",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"4.0.0"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc || ^15",react:"^17 || ^18 || >=19.0.0-beta || ^19"}};var pe="A",ce="V",ue=fe(se.default.version),ge=fe(le.version);function fe(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function x(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let n=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,d=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:n,cloudName:t},url:{...e?.url,secureDistribution:d,privateCdn:o}},e)}function J(e){return Object.assign({product:pe,sdkCode:ce,sdkSemver:ge,techVersion:ue,feature:""},e)}function L(e,t,n){return(0,me.constructCloudinaryUrl)({options:e,config:x(t),analytics:J(n)})}function Z({loaderOptions:e,imageProps:t,cldOptions:n,cldConfig:d={}}){let o={...t,...n};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let i=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*i))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return L(o,d)}var Se=(0,b.forwardRef)(function(t,n){let d=!1,o=["assetType","config","deliveryType","strictTransformations"];Ce.transformationPlugins.forEach(({props:r})=>{Object.keys(r).forEach(y=>{if(o.includes(y))throw new Error(`Option ${y} already exists!`);o.push(y)})});let i={alt:t.alt,src:t.src};Object.keys(t).filter(r=>typeof r=="string"&&!o.includes(r)).forEach(r=>i[r]=t[r]);let p=Object.keys(i).map(r=>`${r}:${i[r]}`).join(";"),[O,C]=(0,b.useState)(p),c={};o.forEach(r=>{let m=t[r];m&&(c[r]=m)});let U=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||U?.unoptimized===!0)&&(i.src=L({...c,width:i.width,height:i.height,src:i.src,format:"default",quality:"default"},t.config));async function s(r){let m=!0;if(d)return;if(d=!0,typeof t.onError=="function"){let _=t.onError(r);typeof _=="boolean"&&_===!1&&(m=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(m=!1);if(m===!1)return;let y=r.target,P=await(0,ee.pollForProcessingImage)({src:y.src});typeof P.error=="string"&&process.env.NODE_ENV==="development"&&console.error(`[CldImage] Failed to load image ${t.src}: ${P.error}`),P.success&&C(`${p};${Date.now()}`)}let T=(0,b.useCallback)(s,[ee.pollForProcessingImage,p]),E=ye.default;return"default"in E&&(E=E.default),b.default.createElement(E,{key:O,...i,loader:r=>Z({loaderOptions:r,imageProps:i,cldOptions:c,cldConfig:t.config}),onError:T,ref:n})}),te=Se;var A=h(require("react")),Ie=h(require("next/head"));function F(e){return L({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var Ve="summary_large_image",ke=({excludeTags:e=[],twitterTitle:t,keys:n={},...d})=>{let{alt:o}=d,{width:i=1200,height:p=627}=d;i=typeof i=="string"?parseInt(i):i,p=typeof p=="string"?parseInt(p):p;let O=F({...d,width:i,height:p}),C=F({...d,width:i,height:p,format:d.format||"webp"}),c={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n};return A.default.createElement(Ie.default,null,A.default.createElement("meta",{key:c["og:image"],property:"og:image",content:O}),A.default.createElement("meta",{key:c["og:image:secure_url"],property:"og:image:secure_url",content:O}),A.default.createElement("meta",{key:c["og:image:width"],property:"og:image:width",content:`${i}`}),A.default.createElement("meta",{key:c["og:image:height"],property:"og:image:height",content:`${p}`}),o&&A.default.createElement("meta",{key:c["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&A.default.createElement("meta",{key:c["twitter:title"],property:"twitter:title",content:t||" "}),A.default.createElement("meta",{key:c["twitter:card"],property:"twitter:card",content:Ve}),A.default.createElement("meta",{key:c["twitter:image"],property:"twitter:image",content:C}))},ne=ke;var K=h(require("react"));var g=h(require("react")),Oe=h(require("next/script")),v=require("@cloudinary-util/url-loader");function he(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ge=()=>{let e=g.default.useId?.()??null,t=g.default.useRef(Math.floor(Math.random()*100)).current;return`cloudinary-uploadwidget-${e?e.replace(/:/g,""):t}`},Re=({children:e,config:t,onError:n,onOpen:d,onUpload:o,options:i,signatureEndpoint:p,uploadPreset:O,...C})=>{let c=Ge(),U=(0,g.useRef)(),s=(0,g.useRef)(),[T,E]=(0,g.useState)(void 0),[r,m]=(0,g.useState)(void 0),[y,P]=(0,g.useState)(!0),_=x(t),V=p&&(0,v.generateSignatureCallback)({signatureEndpoint:String(p),fetch}),j=(0,v.getUploadWidgetOptions)({uploadPreset:O||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:V,...i},_),k=(0,v.generateUploadWidgetResultCallback)({onError:a=>{E(a),typeof n=="function"&&n(a,{widget:s.current,...f})},onResult:a=>{if(typeof a?.event!="string")return;m(a);let w=v.UPLOAD_WIDGET_EVENTS[a.event];if(typeof w=="string"&&typeof C[w]=="function"){let R=C[w];R(a,{widget:s.current,...f})}let z=`${w}Action`;if(z&&typeof C[z]=="function"){let R=C[z];R(a)}}});(0,g.useEffect)(()=>{if(typeof r>"u")return;r.event==="success"&&typeof o=="function"&&(process.env.NODE_ENV==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(r,s.current))},[r]);function B(){P(!1),U.current||(U.current=window.cloudinary),he(()=>{s.current||(s.current=S())})}(0,g.useEffect)(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function u(a,w=[]){if(s.current||(s.current=S()),typeof s?.current[a]=="function")return s.current[a](...w)}function Y(a){u("close",[a])}function I(a){return u("destroy",[a])}function N(){u("hide")}function W(){return u("isDestroyed")}function M(){return u("isMinimized")}function $(){return u("isShowing")}function G(){u("minimize")}function D(a,w){u("open",[a,w]),typeof d=="function"&&d(s.current)}function H(){u("show")}function X(){u("update")}let f={close:Y,destroy:I,hide:N,isDestroyed:W,isMinimized:M,isShowing:$,minimize:G,open:D,show:H,update:X};function S(){return U.current?.createUploadWidget(j,k)}return g.default.createElement(g.default.Fragment,null,typeof e=="function"&&e({cloudinary:U.current,widget:s.current,results:r,error:T,isLoading:y,...f}),g.default.createElement(Oe.default,{id:c,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:B,onError:a=>console.error(`Failed to load Cloudinary Upload Widget: ${a.message}`)}))},q=Re;var je=({className:e,children:t,onClick:n,onError:d,onOpen:o,onUpload:i,onAbort:p,onBatchCancelled:O,onClose:C,onDisplayChanged:c,onPublicId:U,onQueuesEnd:s,onQueuesStart:T,onRetry:E,onShowCompleted:r,onSourceChanged:m,onSuccess:y,onTags:P,onUploadAdded:_,options:V,signatureEndpoint:j,uploadPreset:k,onAbortAction:B,onBatchCancelledAction:u,onCloseAction:Y,onDisplayChangedAction:I,onPublicIdAction:N,onQueuesEndAction:W,onQueuesStartAction:M,onRetryAction:$,onShowCompletedAction:G,onSourceChangedAction:D,onSuccessAction:H,onTagsAction:X,onUploadAddedAction:f,...S})=>K.default.createElement(K.default.Fragment,null,K.default.createElement(q,{onError:d,onOpen:o,onUpload:i,onAbort:p,onBatchCancelled:O,onClose:C,onDisplayChanged:c,onPublicId:U,onQueuesEnd:s,onQueuesStart:T,onRetry:E,onShowCompleted:r,onSourceChanged:m,onSuccess:y,onTags:P,onUploadAdded:_,options:V,signatureEndpoint:j,uploadPreset:k,onAbortAction:B,onBatchCancelledAction:u,onCloseAction:Y,onDisplayChangedAction:I,onPublicIdAction:N,onQueuesEndAction:W,onQueuesStartAction:M,onRetryAction:$,onShowCompletedAction:G,onSourceChangedAction:D,onSuccessAction:H,onTagsAction:X,onUploadAddedAction:f},({open:a,isLoading:w})=>{function z(R){R.preventDefault(),a(),typeof n=="function"&&n(R)}return K.default.createElement("button",{...S,className:e||"",onClick:z,disabled:w},t||"Upload")})),ie=je;var l=h(require("react")),Pe=h(require("next/script")),we=h(require("next/head")),Ae=require("@cloudinary-util/url-loader");var Ue=[],Ee="1.11.1",Be=e=>{let{className:t,config:n,disableRemotePlayback:d,height:o,id:i,onDataLoad:p,onError:O,onMetadataLoad:C,onPause:c,onPlay:U,onEnded:s,width:T}=e,E=(0,l.useId)(),[r,m]=(0,l.useState)(!1),[y,P]=(0,l.useState)(!1),_=x(n),V=(0,Ae.getVideoPlayerOptions)(e,_),{publicId:j}=V;if(typeof j>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let k=(0,l.useRef)(),B=(0,l.useRef)(),u=e.videoRef||B,Y=(0,l.useRef)(),I=e.playerRef||Y,N=i||`player-${E.replace(/:/g,"")}`,W="cld-video-player cld-fluid";t&&(W=`${W} ${t}`);let M={error:O,loadeddata:p,loadedmetadata:C,pause:c,play:U,ended:s};function $(f){let S=M[f.type];typeof S=="function"&&S(X())}let G=()=>{I.current?.videojs?.cloudinary&&I.current.videojs.cloudinary.dispose(),Ue=Ue.filter(f=>f!==N),I.current=null,P(!1)},D=()=>{typeof window<"u"&&"cloudinary"in window&&u.current&&!y&&(k.current=window.cloudinary,I.current&&G(),I.current=k.current.videoPlayer(u.current,V),P(!0),Object.keys(M).forEach(f=>{typeof M[f]=="function"&&I.current?.on(f,$)}))};function H(){m(!0),"cloudinary"in window&&D()}(0,l.useEffect)(()=>(r&&typeof window<"u"&&"cloudinary"in window&&D(),()=>{G()}),[]),(0,l.useEffect)(()=>{r&&!y&&typeof window<"u"&&"cloudinary"in window&&D()},[r,y]);function X(){return{player:I.current,video:u.current}}return l.default.createElement(l.default.Fragment,null,l.default.createElement(we.default,null,l.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.css`,rel:"stylesheet"})),l.default.createElement("div",{style:{width:"100%"}},l.default.createElement("video",{ref:u,id:N,className:W,width:T,height:o,disableRemotePlayback:d}),l.default.createElement(Pe.default,{id:`cloudinary-videoplayer-${N}`,src:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.js`,onLoad:H,onError:f=>console.error(`Failed to load Cloudinary Video Player: ${f.message}`)})))},de=Be;var _e=require("@cloudinary-util/url-loader");function xe(e,t,n){return(0,_e.constructCloudinaryUrl)({options:{assetType:"video",format:"auto:video",...e},config:x(t),analytics:J(n)})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map